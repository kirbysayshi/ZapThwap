<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>ZAP - Explosion Demo</title>
	</head>
	<body>
		<canvas id="cvsWorld" width="600" height="600" style="background-color: black;"></canvas>
		<div id="info"></div>
		<script type="text/javascript" src="../lib/glMatrix.js"></script>
		<script type="text/javascript" src="../lib/jquery-1.4.2.min.js"></script>
		
		<script src="../zap/Thwap.js" type="text/javascript" charset="utf-8"></script>
		<script src="../zap/Key.js" type="text/javascript" charset="utf-8"></script>
		<script src="../zap/ZAP.js" type="text/javascript" charset="utf-8"></script>
		<script src="../zap/Entities.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
var  TWorld = new THWAP.World()
	,$cWorld = $("#cvsWorld")
	,info = $("#info")[0]
	,ctx = $cWorld[0].getContext('2d')
	,numParticles = 30;	

var middle = [ $cWorld[0].width / 2, $cWorld[0].height / 2, 0 ];	
for(var i = 0; i < numParticles; i++){
	var  pos = vec3.add(middle, [Math.random()*20, Math.random()*20, 0], vec3.create())
		,p = new THWAP.SingleVertexBody();
	
	p
		.moveTo(pos)
		.setPassiveFriction(0)
		.setCollisionFriction(0.5)
		.vlist[0].rad = 8;
	
	TWorld.addBody(p);
}		

KEY.listen(function(down){
	if(down[27].delta > 0){ ZAP.CGLM.stop(); }
});

ZAP.CGLM.setFPS(200);

ZAP.CGLM.register(function priorityOne(dt){
	KEY.dispatcher();
	TWorld.step(dt*0.001); // dt comes in ms, Thwap needs seconds
}, function priorityTwo(dt, fps, afps, lag){
	ctx.clearRect(0,0,2000,2000);
	for(var i = 0; i < TWorld.blist.length; i++){
		TWorld.blist[i].debugDraw(ctx);
	}
	info.innerHTML = "FPS: " + fps + ", AVG FPS: " + afps + " LAG: " + lag;
});

ZAP.CGLM.start();
		
		</script>
	</body>
</html>